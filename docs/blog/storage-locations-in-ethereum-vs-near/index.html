<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Storage Locations in Ethereum vs. NEAR - GeekLaunch</title><meta name=description content="The keywords memory, storage, calldata are a big pain point for new Solidity developers—just look at the sheer number of questions that have been asked and articles that have been written 1 2 3 4 about the topic, not to mention the multiple, different, sections (and here, and here) the Solidity documentation dedicates to the topic.
Storage locations in Solidity are no joke!
I hope to accomplish two things in this write-up:"><meta name=author content="Jacob Lindahl"><meta property="og:type" content="article"><meta property="og:title" content="Storage Locations in Ethereum vs. NEAR"><meta property="og:description" content="The keywords memory, storage, calldata are a big pain point for new Solidity developers. How does NEAR compare?"><meta property="og:url" content="https://geeklaunch.io/blog/storage-locations-in-ethereum-vs-near/"><meta property="og:image" content="https://geeklaunch.io/img/geeklaunch.png"><meta property="og:site_name" content="GeekLaunch"><meta name=twitter:card content="summary"><meta name=twitter:site content="Geek_Launch"><meta name=twitter:creator content="sudo_build"><link id=highlight-theme-light rel=stylesheet href=/github.min_4917475948316153746.css><link id=highlight-theme-dark disabled rel=stylesheet href=/github-dark.min_15794025392105988476.css><script src=/highlight.min_12813739840627204152.js></script>
<script src=/solidity.min_1698098518847126779.js></script>
<link href=/normal_13953566615062847353.css rel=stylesheet><script src=/css@1_15597864207408232852.js></script>
<script src=/themes.js@0.0_2721045479065658286.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DMBPKLBF8X"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-DMBPKLBF8X",{anonymize_ip:!1})}</script><style>html{scroll-behavior:smooth;scroll-padding-top:2em}@media(min-width:768px){html{scroll-padding-top:64px}}.table{display:initial}@keyframes highlight{0%{background-color:rgba(226,230,30,.4);outline:.2rem solid rgba(226,230,30,.4)}100%{background-color:unset;outline:.2rem solid transparent}}:target{animation:highlight 1.2s forwards}</style><script>(()=>{document.addEventListener("DOMContentLoaded",()=>{hljs.highlightAll();const e=new window.Themes;window.themes=e;const t=()=>{const t=document.getElementById("highlight-theme-dark"),n=document.getElementById("highlight-theme-light");e.documentTheme==="dark"?(n.disabled=!0,t.disabled=!1):(n.disabled=!1,t.disabled=!0)};t(),e.onChange=e=>{t()};const n=document.getElementById("TableOfContents");if(n){const e=Array.from(n.querySelectorAll("a[href]"));e.forEach(e=>{const n=e.getAttribute("href").split("#")[1];if(!n)return;const s=document.getElementById(n);if(!s)return;const t=document.createElement("a");t.href="#"+n,t.className="headingAnchor",t.innerText="#",s.insertAdjacentElement("afterbegin",t)})}})})()</script></head><body class="bg:fade-16@dark font:fade-86@dark"><nav id=mainNav class="w:full
fixed@sm
bg:white/.9
bg:fade-16/.9@dark
z:1000
backdrop-filter:blur(3px)"><div class="h:full
w:full
max-w:1200
mx:auto
px:32
d:flex
flex-direction:column
flex-direction:row@sm
align-items:center"><a href=/ class="block mr:3 p:8 filter:brightness(1.5):hover ~filter|0.1s"><img width=40 srcset="/img/geeklaunch_hu88a4d911d4cccede63bd09ba1f0e84eb_11841_40x0_resize_box_3.png, /img/geeklaunch_hu88a4d911d4cccede63bd09ba1f0e84eb_11841_80x0_resize_box_3.png 2x, /img/geeklaunch_hu88a4d911d4cccede63bd09ba1f0e84eb_11841_160x0_resize_box_3.png 4x" src=/img/geeklaunch_hu88a4d911d4cccede63bd09ba1f0e84eb_11841_40x0_resize_box_3.png title=GeekLaunch alt="GeekLaunch logo"></a><div class="ml:auto@sm
w:full
d:flex
flex-wrap:wrap
justify-content:space-between
justify-content:flex-end@sm
{font:semibold;font:fade}_a
font:fade-10_a:hover
font:fade-80_a@dark
font:fade-96_a:hover@dark
p:12_a
p:18_a@sm"><a href=/about/ title>About</a>
<a href=/blog/ title>Posts</a>
<a href="https://www.youtube.com/c/GeekLaunch?sub_confirmation=1" title>YouTube</a>
<a href=https://weareindy.com/app/shared/forms/634577ccb25f8365f4aa7f42/zw1Icw3aBtCI90eLSzQVkpZiigUEBLHeaNKmJobnx4kTaPYMixQM3gDZMCFDsSHC/ title>Contact</a></div></div></nav><div class="d:flex flex:column@<=sm pt:90@sm px:24 jc:center gap:44 word-break:break-word"><div class="max-w:700 w:full box:content-box"><article class="box:border-box pt:32"><header class=mb:32><h1 class="font:40 font:extrabold">Storage Locations in Ethereum vs. NEAR</h1><p class="font:18 mt:12 lh:1.4 font:semibold color:fade-30 color:fade-70@dark">The keywords memory, storage, calldata are a big pain point for new Solidity developers. How does NEAR compare?</p><div class="mt:16 f:fade-60 text-decoration:underline_:where(a):hover"><p><a href=https://twitter.com/sudo_build rel=author>Jacob Lindahl</a><span class=mx:10>&mdash;</span><a href=https://geeklaunch.io/blog/storage-locations-in-ethereum-vs-near/><time pubdate datetime="2021-12-21 00:00:00 +0000 UTC" title="December 21, 2021">Dec 21, 2021</time></a></p></div></header><aside><details class="ml:12_ul
bl:2
bl:fade-86
bl:fade-40@dark
mb:24
py:4
pl:12
lh:1.5
{content:'#';pr:.3em;color:fade-70}_li::before
{color:fade-50}_li::before@dark
{text-underline-offset:3;font:medium;text-decoration:underline;text-decoration-color:fade-86;color:fade-40}_a
{text-decoration-color:fade-30;color:fade-80}_a@dark
{text-decoration-color:fade-60;color:fade-10}_a:hover
{text-decoration-color:fade-60;color:fade-90}_a:hover@dark"><summary class="cursor:pointer
font-weight:semibold
color:fade-40
color:fade-80@dark
color:fade-70::marker
color:fade-50::marker@dark">Contents</summary><nav id=TableOfContents><ul><li><a href=#quick-explanation>Quick Explanation</a></li><li><a href=#practical-example>Practical Example</a></li><li><a href=#the-alternative>The Alternative</a></li></ul></nav></details></aside><div class="{text-decoration-color:fade-60}_:where(a):hover
{text-decoration:underline;text-decoration-color:fade-86;color:fade-40}_:where(a)
{text-decoration-color:fade-30;color:fade-90}_:where(a)@dark
{bl:4|solid;b:fade-84;color:fade-34}_:where(blockquote)
{b:fade-38;color:fade-86}_:where(blockquote)@dark
{font:90%;color:blue-20}_:where(code)
{color:blue-86}_:where(code)@dark
{text-decoration:1;line-through;fade-68}_:where(del)
{text-decoration-color:red-64}_:where(del)@dark
{text:14;p:10;20;0;width:fit;mx:auto;font:fade-56}_:where(figcaption)
{font:fade-57}_:where(figcaption)@dark
{font:40;font:extrabold}_:where(h1)
{mt:.5em}_:where(h1,h2,h3)+:where(h1,h2,h3)
{mt:2em}_:where(h1,h2,h3,h4,h5,h6)
{mb:1em;font:32}_:where(h2)
{font:24}_:where(h3)
{font:20}_:where(h4)
{font:16}_:where(h5)
{font:14}_:where(h6)
{font:fade-44}_:where(li)::marker
{font:fade-68}_:where(li)::marker@dark
{pl:.375em}_:where(li)
{text-decoration:underline;#fce016;bg:transparent;text-decoration-color:rgb(252;224;22/.5)@dark}_:where(mark)
{font:fade-36;font:16;line-height:1.65}_:where(p,li,details)
{font:fade-80}_:where(p,li,details)@dark
{my:0.125em}_:where(li>ul)
{my:1.125em}_:where(p,pre,blockquote,figure,ul,ol,table)
{mt:0!}>:first-child
{width:full;border-spacing:0}_:where(table)
{v:baseline}_:where(td)
{pl:0}_:where(td,th):first-child
{pr:0}_:where(td,th):last-child
{bb:1;solid;fade-92/.06;p:6;b:fade-4/.04@dark}_:where(td,th)
{font:fade-78;font:14;text:left;font:fade-12@dark}_:where(th)
{font:semibold}_:where(th,a,mark,:not(pre)>code)
{list-style-type:disc}_:where(ul)
{pl:1.5em}_:where(ul,ol,blockquote)
{max-width:full}_:where(video,img)
{text-underline-offset:3}_:where(a,mark)
{height:0.1rem;bg:fade-80;mx:40%;my:1.5rem}_:where(hr)
{bg:fade-40}_:where(hr)@dark
{cursor:pointer}_:where(details>summary)
{text-decoration:none;pr:16;font:medium;color:fade-80}_.headingAnchor
{color:fade-60}_.headingAnchor:hover
{opacity:0;position:absolute;translateX(-100%)}_.headingAnchor@sm
{opacity:1}_:hover>.headingAnchor
{opacity:1}_:target>.headingAnchor
{color:fade-50}_.headingAnchor@dark
{color:fade-70}_.headingAnchor:hover@dark
{border-radius:2;lh:1.5}_:where(pre>code)"><p>The keywords <code>memory</code>, <code>storage</code>, <code>calldata</code> are a big pain point for new Solidity developers—just look at the sheer number of <a href=https://ethereum.stackexchange.com/questions/tagged/storage+solidity>questions that have been asked</a> and articles that have been written <a href=https://www.geeksforgeeks.org/storage-vs-memory-in-solidity/>1</a> <a href=https://solidity-by-example.org/data-locations/>2</a> <a href=https://medium.com/coinmonks/ethereum-solidity-memory-vs-storage-which-to-use-in-local-functions-72b593c3703a>3</a> <a href=https://dlt-repo.net/storage-vs-memory-vs-stack-in-solidity-ethereum/>4</a> about the topic, not to mention the <a href=https://docs.soliditylang.org/en/latest/introduction-to-smart-contracts.html#storage-memory-and-the-stack>multiple</a>, <a href=https://docs.soliditylang.org/en/latest/types.html#data-location>different</a>, <a href=https://docs.soliditylang.org/en/latest/internals/layout_in_storage.html>sections</a> (and <a href=https://docs.soliditylang.org/en/latest/internals/layout_in_memory.html>here</a>, and <a href=https://docs.soliditylang.org/en/latest/internals/layout_in_calldata.html>here</a>) the Solidity documentation dedicates to the topic.</p><p>Storage locations in Solidity are no joke!</p><p>I hope to accomplish two things in this write-up:</p><ol><li>Clarify the use of <code>storage</code>, <code>memory</code>, and <code>calldata</code>.</li><li>Introduce a more intuitive alternative to the whole idea.</li></ol><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube-nocookie.com/embed/xu8yPZQ7QL8 style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><h2 id=quick-explanation>Quick Explanation</h2><p>Conceptually, there are basically two places that smart contract&rsquo;s data can live: either it&rsquo;s concretely stored and saved on-chain (<em>storage</em>), or it exists only during the execution of a transaction (<em>memory</em>). These could be compared to a traditional application either writing a file to disk or just putting a value in a variable: if the application (smart contract) stops running (transaction ends), the variables (<em>memory</em>) will be cleared, but the filesystem (<em>storage</em>) will remain, and when the application runs again (another transaction calls the contract), that data will still be there for use again.</p><p>(Technically, there&rsquo;s also a <em>stack</em> storage location, but the Solidity compiler will handle that for you unless you write EVM assembly.)</p><p>For the most part, Solidity manages to figure out where to store variables all by itself. The only times the programmer must specify a storage location is when the data type is <em>complex</em>—usually that means a struct or dynamic array.</p><p>That covers the difference between storage and memory on a high level. For more details, check out the documentation linked previously.</p><p>What&rsquo;s calldata? It&rsquo;s like a special case of memory: when an external function receives a message call, the arguments are stored in calldata, which means they&rsquo;re immutable, but they also consume <em>slightly</em> less gas than if they were in memory. It could be compared to an immutable reference to another application&rsquo;s memory since external message calls could potentially come from other contracts as well.</p><p>Got it? Let&rsquo;s run through a quick example.</p><h2 id=practical-example>Practical Example</h2><p><a href="https://remix.ethereum.org/?gist=ac0bce6c2c3c59ab979de2b179ae1e55">Open this code sample in Remix IDE</a></p><pre><code class=language-solidity>contract StorageTest {
    struct ComplexStruct {
        uint256 x;
        uint256 y;
    }

    ComplexStruct public myValue;

    function reset () public {
        myValue.x = 0;
        myValue.y = 0;
    }

    function setStruct1 (ComplexStruct calldata c) public { // 67821
        myValue = c; // copy and increment
        myValue.x = myValue.x + 1;
        myValue.y = myValue.y + 1;
    }

    function setStruct2 (ComplexStruct calldata c) public { // 66374
        // increment without copy
        myValue.x = c.x + 1;
        myValue.y = c.y + 1;
    }

    function setStruct3 (ComplexStruct memory c) public { // 67363
        myValue = c; // copy and increment
        myValue.x = myValue.x + 1;
        myValue.y = myValue.y + 1;
    }

    function setStruct4 (ComplexStruct memory c) public { // 66937
        // increment without copy
        myValue.x = c.x + 1;
        myValue.y = c.y + 1;
    }

    function getStruct () public view returns (ComplexStruct memory) {
        return myValue;
    }
}
</code></pre><p>(The commented-out numbers after the function signatures are the gas units consumed for executing each function, according to Remix IDE.)</p><p>Though it&rsquo;s not explicitly stated in the code listing, <code>myValue</code> is allocated to the contract&rsquo;s storage.</p><p>The first two functions (<code>setStruct1</code>, <code>setStruct2</code>) take in a struct stored in <code>calldata</code>, and thus, the more efficient of the two (<code>setStruct2</code>), is actually the most efficient in the whole contract.</p><p><code>setStruct3</code> and <code>setStruct4</code> are identical to their N−2 analogues, with the exception that they use <code>memory</code> instead of <code>calldata</code>.</p><p>Note that we could not call <code>setStruct1</code> or <code>setStruct2</code> from another function within the contract, because we cannot convert from <code>memory</code> to <code>calldata</code>:</p><pre><code class=language-solidity>setStruct1(ComplexStruct({ x: 1, y: 2 }));
// TypeError: Invalid type for argument in function call. Invalid implicit conversion from struct StorageTest.ComplexStruct memory to struct StorageTest.ComplexStruct calldata requested.
</code></pre><p>Remember: calldata is <em>immutable</em>!</p><h2 id=the-alternative>The Alternative</h2><p>This whole <code>memory</code>-<code>calldata</code> fiasco is pretty complicated. Unfortunately, there are many non-ideal design decisions still influencing the modern Solidity language. However, if you must deploy to an EVM-compatible chain, Solidity is still the language of choice. It has the best editor support, tooling, resources, and community of any other smart contract DSL.</p><p>That&rsquo;s a necessary qualifier—&ldquo;smart contract DSL&rdquo;—because, as it turns out, smart contracts can be written in general-purpose programming languages as well, even those with richer ecosystems than Solidity&rsquo;s.</p><p>Enter: <a href=https://near.org>NEAR</a>.</p><p>NEAR&rsquo;s virtual machine runs WebAssembly code, meaning one could conceivably write smart contracts for NEAR in any GPL with a WASM compile target. NEAR provides official SDKs for two of those languages: Rust and AssemblyScript.</p><p>Rust is a popular programming language developed by Mozilla. It&rsquo;s strongly typed, with a friendly compiler and an even friendlier community, and it&rsquo;s <a href=https://insights.stackoverflow.com/survey/2021#technology-most-loved-dreaded-and-wanted>the #1 most-loved programming language for six years running</a>.</p><p>AssemblyScript is a dialect of TypeScript, which is a strict superset of JavaScript. This means that traditional web2 developers can pick it up in no time!</p><p>Using a general-purpose programming language for smart contracts means that the programming paradigm is much more normalized: smart contracts merely run in the context of a regular WASM VM injected with the blockchain-specific environment globals.</p><p>Programmers don&rsquo;t have to specify a storage location for data anymore: variables are just normal variables, and there&rsquo;s an SDK for I/O to the key-value storage system.</p><p><a href=https://github.com/near-examples/counter/blob/master/assembly/main.ts>Check out this simple example contract</a>, written in AssemblyScript. Permanent, on-chain storage is invoked with a put/get API, making it much more obvious what exactly is happening to the data.</p><p>If you&rsquo;re familiar with Rust, you may find <a href=https://github.com/near-examples/NFT/blob/master/nft/src/lib.rs>this full NFT implementation</a> more interesting.</p><p>When I first encountered the NEAR ecosystem, I was stunned at how developer-friendly the contract programming interface was. In the time since then, it&rsquo;s only gotten better! (Not to mention the gas fees are minuscule compared to ETH: you&rsquo;re looking at fractions of a cent.) If you&rsquo;re interested in learning more about smart contract development on the NEAR ecosystem, head over to <a href=https://www.near.university/>NEAR University</a> and sign up for one of the free training bootcamps.</p><p>You can find a comprehensive suite of NEAR smart contracts on the <a href=https://github.com/Learn-NEAR>Learn NEAR GitHub organization</a>, as well as a bevy of tutorials and examples on the <a href=https://github.com/near-examples>NEAR Examples GitHub origanization</a>.</p><p>Good luck!</p><hr><p>I&rsquo;m a software engineer for <a href=https://near.org/>NEAR Protocol</a>, head of education at the <a href=https://www.blockchainacceleration.org/>Blockchain Acceleration Foundation</a>, and a graduate
student at the <a href=https://www.titech.ac.jp/>Tokyo Institute of Technology</a>.</p><p>Connect with me <a href=https://twitter.com/sudo_build>on Twitter</a>.</p></div></article><footer class="py:24 f:fade-50 f:fade-60@dark f:14 d:flex flex:col gap:8"><p>This work is licensed under <a rel=license href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA 4.0</a>.</p><p>&copy; Copyright 2022 Jacob Lindahl</p><p class="d:flex
{p:5}_a
{w:18;fill:fade-50}_svg
{fill:fade-60}_svg@dark
{fill:fade-10}_a:hover_svg
{fill:fade-90}_a:hover_svg@dark"><a href=https://youtube.com/GeekLaunch title=YouTube><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>YouTube</title><path d="M23.498 6.186A3.016 3.016.0 0021.376 4.05C19.505 3.545 12 3.545 12 3.545s-7.505.0-9.377.505A3.017 3.017.0 00.502 6.186C0 8.07.0 12 0 12s0 3.93.502 5.814a3.016 3.016.0 002.122 2.136c1.871.505 9.376.505 9.376.505s7.505.0 9.377-.505a3.015 3.015.0 002.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg><span class=sr-only>YouTube channel</span></a>
<a href=https://twitter.com/Geek_Launch title=Twitter><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958.0 002.163-2.723c-.951.555-2.005.959-3.127 1.184A4.92 4.92.0 0011.78 8.288C7.69 8.095 4.067 6.13 1.64 3.162A4.822 4.822.0 00.974 5.637c0 1.71.87 3.213 2.188 4.096A4.904 4.904.0 01.934 9.117v.06a4.923 4.923.0 003.946 4.827 4.996 4.996.0 01-2.212.085 4.936 4.936.0 004.604 3.417A9.867 9.867.0 011.17 19.611c-.39.0-.779-.023-1.17-.067a13.995 13.995.0 007.557 2.209c9.053.0 13.998-7.496 13.998-13.985.0-.21.0-.42-.015-.63A9.935 9.935.0 0024 4.59z"/></svg><span class=sr-only>Twitter profile</span></a>
<a rel=me href=https://techhub.social/@geeklaunch title=Mastodon><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Mastodon</title><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792.0 11.813.0h-.03c-3.98.0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057.0 00.023-.043v-1.809a.052.052.0 00-.02-.041.053.053.0 00-.046-.01 20.282 20.282.0 01-4.709.545c-2.73.0-3.463-1.284-3.674-1.818a5.593 5.593.0 01-.319-1.433.053.053.0 01.066-.054c1.517.363 3.072.546 4.632.546.376.0.75.0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23.0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112.0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311.0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13.0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"/></svg><span class=sr-only>Mastodon profile</span></a></p></footer></div></div></body></html>