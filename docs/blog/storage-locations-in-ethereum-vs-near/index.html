<!DOCTYPE html>
<html><head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <title>Storage Locations in Ethereum vs. NEAR - GeekLaunch</title>

    
    
    <meta name="description" content="The keywords memory, storage, calldata are a big pain point for new Solidity developers—just look at the sheer number of questions that have been asked and articles that have been written 1 2 3 4 about the topic, not to mention the multiple, different, sections (and here, and here) the Solidity documentation dedicates to the topic.
Storage locations in Solidity are no joke!
I hope to accomplish two things in this write-up:" />
    <meta name="author" content="" />
    

    <link href="https://unpkg.com/@master/normal.css" rel="stylesheet">
    <script src="https://unpkg.com/@master/css"></script>
    <script src="https://unpkg.com/themes.js"></script>
    <script>window.themes = new window.Themes()</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DMBPKLBF8X"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-DMBPKLBF8X', { 'anonymize_ip': false });
}
</script>

<style>
  html {
    scroll-behavior: smooth;
  }

  :target:before {
    content: "";
    display: block;
    height: 100px;
    margin: -100px 0 0;
  }

</style>
</head>
<body class="bg:fade-16@dark font:fade-86@dark">
    <nav class="w:full fixed@sm bg:fade-16/.95@dark bg:white z:1000">
    <div class="
        h:full
        w:full
        max-w:1200
        mx:auto
        px:32
        d:flex
        flex-direction:column
        flex-direction:row@sm
        align-items:center
    ">
        <a href="/" class="block mr:3 p:8 filter:brightness(1.5):hover ~filter|0.1s">
            <img class="w:40" src="/img/geeklaunch.png" title="GeekLaunch" alt="GeekLaunch logo">
        </a>

        <div class="
            ml:auto@sm
            w:full
            d:flex
            flex-wrap:wrap
            justify-content:space-between
            justify-content:flex-end@sm
        ">
            
            
            
            
            <a class="
                font:semibold
                font:fade
                font:fade-10:hover
                font:fade-30.active
                font:fade-80@dark
                font:fade-96:hover@dark
                font:fade-90.active@dark
                p:12
                p:18@sm
                transition:150ms;ease-in
                
            " href="/about/" title="">About</a>
            
            
            <a class="
                font:semibold
                font:fade
                font:fade-10:hover
                font:fade-30.active
                font:fade-80@dark
                font:fade-96:hover@dark
                font:fade-90.active@dark
                p:12
                p:18@sm
                transition:150ms;ease-in
                
            " href="/blog/" title="">Posts</a>
            
            
            <a class="
                font:semibold
                font:fade
                font:fade-10:hover
                font:fade-30.active
                font:fade-80@dark
                font:fade-96:hover@dark
                font:fade-90.active@dark
                p:12
                p:18@sm
                transition:150ms;ease-in
                
            " href="https://www.youtube.com/c/GeekLaunch?sub_confirmation=1" title="">YouTube</a>
            
            
            <a class="
                font:semibold
                font:fade
                font:fade-10:hover
                font:fade-30.active
                font:fade-80@dark
                font:fade-96:hover@dark
                font:fade-90.active@dark
                p:12
                p:18@sm
                transition:150ms;ease-in
                
            " href="https://weareindy.com/app/shared/forms/634577ccb25f8365f4aa7f42/zw1Icw3aBtCI90eLSzQVkpZiigUEBLHeaNKmJobnx4kTaPYMixQM3gDZMCFDsSHC/" title="">Contact</a>
            
        </div>
    </div>
</nav>
<div class="d:flex flex:column@<=sm pt:90@sm px:24 jc:center gap:44 word-break:break-word">
        <div class="max-w:700 w:full box:content-box">
<article class="box:border-box pt:32">
    <header class="mb:32">
        <a class="font:40 font:extrabold" href="https://geeklaunch.net/blog/storage-locations-in-ethereum-vs-near/">Storage Locations in Ethereum vs. NEAR</a>
        <div class="mt:16 f:fade-60">
            <time>Dec 21, 2021</time>
            </div>
    </header>

    
    <aside>
        <details class="
            ml:12_ul
            bl:2
            bl:fade-86
            bl:fade-40@dark
            mb:24
            py:4
            pl:12
            lh:1.5
            {content:'‣';pr:.3em;color:fade-70}_li::before
            {color:fade-50}_li::before@dark
            {text-underline-offset:3;font:medium;text-decoration:underline;text-decoration-color:fade-86;color:fade-40}_a
            {text-decoration-color:fade-30;color:fade-80}_a@dark
            {text-decoration-color:fade-60;color:fade-10}_a:hover
            {text-decoration-color:fade-60;color:fade-90}_a:hover@dark
        ">
            <summary class="
                cursor:pointer
                font-weight:semibold
                color:fade-40
                color:fade-80@dark
                color:fade-70::marker
                color:fade-50::marker@dark
            ">Contents</summary>
            <nav id="TableOfContents">
  <ul>
    <li><a href="#quick-explanation">Quick Explanation</a></li>
    <li><a href="#practical-example">Practical Example</a></li>
    <li><a href="#the-alternative">The Alternative</a></li>
  </ul>
</nav>
        </details>
    </aside>
    <div class="
    {text-decoration-color:fade-60}_:where(a):hover
    {text-decoration:underline;text-decoration-color:fade-86;color:fade-40}_:where(a)
    {text-decoration-color:fade-30;color:fade-90}_:where(a)@dark
    {bl:5|solid;f:fade-34/.1}_:where(blockquote)
    {f:fade-76/.1}_:where(blockquote)@dark
    {font:90%;v:middle}_:where(code)
    {p:2;6;r:4}_:where(code:not(.highlight_*,pre_*))
    {text-decoration:1;line-through;fade-68}_:where(del)
    {text-decoration-color:red-64}_:where(del)@dark
    {text:14;p:10;20;0;width:fit;mx:auto;font:fade-56}_:where(figcaption)
    {font:fade-57}_:where(figcaption)@dark
    {font:40;font:extrabold}_:where(h1)
    {mt:.5em}_:where(h1,h2,h3)+:where(h1,h2,h3)
    {mt:2em}_:where(h1,h2,h3,h4,h5,h6)
    {mb:1em;font:32}_:where(h2)
    {font:24}_:where(h3)
    {font:20}_:where(h4)
    {font:16}_:where(h5)
    {font:14}_:where(h6)
    {font:fade-44}_:where(li)::marker
    {font:fade-68}_:where(li)::marker@dark
    {pl:.375em}_:where(li)
    {text-decoration:underline;#fce016;bg:transparent;text-decoration-color:rgb(252;224;22/.5)@dark}_:where(mark)
    {font:fade-36;font:16;line-height:1.65}_:where(p,li,details)
    {font:fade-80}_:where(p,li,details)@dark
    {my:1.125em}_:where(p,pre,blockquote,figure,ul,ol,table)
    {mt:0!}>:first-child
    {p:20;r:8;overflow:auto;bg:rgba(11,18,23,0.9)!;font:fade-90;lh:1.5}_:where(pre)
    {width:full;border-spacing:0}_:where(table)
    {v:baseline}_:where(td)
    {pl:0}_:where(td,th):first-child
    {pr:0}_:where(td,th):last-child
    {bb:1;solid;fade-92/.06;p:6;b:fade-4/.04@dark}_:where(td,th)
    {font:fade-78;font:14;text:left;font:fade-12@dark}_:where(th)
    {font:semibold}_:where(th,p_code,li_code,a,mark)
    {list-style-type:disc}_:where(ul)
    {pl:1.5em}_:where(ul,ol,blockquote)
    {max-width:full}_:where(video,img)
    {text-underline-offset:3}_:where(a,mark)
    {height:0.1rem;bg:fade-80;mx:40%;my:1.5rem}_:where(hr)
    {bg:fade-40}_:where(hr)@dark
    {cursor:pointer}_:where(details>summary)
"><p>The keywords <code>memory</code>, <code>storage</code>, <code>calldata</code> are a big pain point for new Solidity developers—just look at the sheer number of <a href="https://ethereum.stackexchange.com/questions/tagged/storage+solidity">questions that have been asked</a> and articles that have been written <a href="https://www.geeksforgeeks.org/storage-vs-memory-in-solidity/">1</a> <a href="https://solidity-by-example.org/data-locations/">2</a> <a href="https://medium.com/coinmonks/ethereum-solidity-memory-vs-storage-which-to-use-in-local-functions-72b593c3703a">3</a> <a href="https://dlt-repo.net/storage-vs-memory-vs-stack-in-solidity-ethereum/">4</a> about the topic, not to mention the <a href="https://docs.soliditylang.org/en/latest/introduction-to-smart-contracts.html#storage-memory-and-the-stack">multiple</a>, <a href="https://docs.soliditylang.org/en/latest/types.html#data-location">different</a>, <a href="https://docs.soliditylang.org/en/latest/internals/layout_in_storage.html">sections</a> (and <a href="https://docs.soliditylang.org/en/latest/internals/layout_in_memory.html">here</a>, and <a href="https://docs.soliditylang.org/en/latest/internals/layout_in_calldata.html">here</a>) the Solidity documentation dedicates to the topic.</p>
<p>Storage locations in Solidity are no joke!</p>
<p>I hope to accomplish two things in this write-up:</p>
<ol>
<li>Clarify the use of <code>storage</code>, <code>memory</code>, and <code>calldata</code>.</li>
<li>Introduce a more intuitive alternative to the whole idea.</li>
</ol>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube-nocookie.com/embed/xu8yPZQ7QL8" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<h2 id="quick-explanation">Quick Explanation</h2>
<p>Conceptually, there are basically two places that smart contract&rsquo;s data can live: either it&rsquo;s concretely stored and saved on-chain (<em>storage</em>), or it exists only during the execution of a transaction (<em>memory</em>). These could be compared to a traditional application either writing a file to disk or just putting a value in a variable: if the application (smart contract) stops running (transaction ends), the variables (<em>memory</em>) will be cleared, but the filesystem (<em>storage</em>) will remain, and when the application runs again (another transaction calls the contract), that data will still be there for use again.</p>
<p>(Technically, there&rsquo;s also a <em>stack</em> storage location, but the Solidity compiler will handle that for you unless you write EVM assembly.)</p>
<p>For the most part, Solidity manages to figure out where to store variables all by itself. The only times the programmer must specify a storage location is when the data type is <em>complex</em>—usually that means a struct or dynamic array.</p>
<p>That covers the difference between storage and memory on a high level. For more details, check out the documentation linked previously.</p>
<p>What&rsquo;s calldata? It&rsquo;s like a special case of memory: when an external function receives a message call, the arguments are stored in calldata, which means they&rsquo;re immutable, but they also consume <em>slightly</em> less gas than if they were in memory. It could be compared to an immutable reference to another application&rsquo;s memory since external message calls could potentially come from other contracts as well.</p>
<p>Got it? Let&rsquo;s run through a quick example.</p>
<h2 id="practical-example">Practical Example</h2>
<p><a href="https://remix.ethereum.org/?gist=ac0bce6c2c3c59ab979de2b179ae1e55">Open this code sample in Remix IDE</a></p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#ff5c57">contract</span> <span style="color:#f3f99d">StorageTest</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ff5c57">struct</span> <span style="color:#f3f99d">ComplexStruct</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#9aedfe">uint256</span> x;
</span></span><span style="display:flex;"><span>        <span style="color:#9aedfe">uint256</span> y;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ComplexStruct <span style="color:#ff6ac1">public</span> myValue;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff5c57">function</span> <span style="color:#57c7ff">reset</span> () <span style="color:#ff6ac1">public</span> {
</span></span><span style="display:flex;"><span>        myValue.x <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">0</span>;
</span></span><span style="display:flex;"><span>        myValue.y <span style="color:#ff6ac1">=</span> <span style="color:#ff9f43">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff5c57">function</span> <span style="color:#57c7ff">setStruct1</span> (ComplexStruct calldata c) <span style="color:#ff6ac1">public</span> { <span style="color:#78787e">// 67821
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        myValue <span style="color:#ff6ac1">=</span> c; <span style="color:#78787e">// copy and increment
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        myValue.x <span style="color:#ff6ac1">=</span> myValue.x <span style="color:#ff6ac1">+</span> <span style="color:#ff9f43">1</span>;
</span></span><span style="display:flex;"><span>        myValue.y <span style="color:#ff6ac1">=</span> myValue.y <span style="color:#ff6ac1">+</span> <span style="color:#ff9f43">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff5c57">function</span> <span style="color:#57c7ff">setStruct2</span> (ComplexStruct calldata c) <span style="color:#ff6ac1">public</span> { <span style="color:#78787e">// 66374
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        <span style="color:#78787e">// increment without copy
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        myValue.x <span style="color:#ff6ac1">=</span> c.x <span style="color:#ff6ac1">+</span> <span style="color:#ff9f43">1</span>;
</span></span><span style="display:flex;"><span>        myValue.y <span style="color:#ff6ac1">=</span> c.y <span style="color:#ff6ac1">+</span> <span style="color:#ff9f43">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff5c57">function</span> <span style="color:#57c7ff">setStruct3</span> (ComplexStruct <span style="color:#ff6ac1">memory</span> c) <span style="color:#ff6ac1">public</span> { <span style="color:#78787e">// 67363
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        myValue <span style="color:#ff6ac1">=</span> c; <span style="color:#78787e">// copy and increment
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        myValue.x <span style="color:#ff6ac1">=</span> myValue.x <span style="color:#ff6ac1">+</span> <span style="color:#ff9f43">1</span>;
</span></span><span style="display:flex;"><span>        myValue.y <span style="color:#ff6ac1">=</span> myValue.y <span style="color:#ff6ac1">+</span> <span style="color:#ff9f43">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff5c57">function</span> <span style="color:#57c7ff">setStruct4</span> (ComplexStruct <span style="color:#ff6ac1">memory</span> c) <span style="color:#ff6ac1">public</span> { <span style="color:#78787e">// 66937
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        <span style="color:#78787e">// increment without copy
</span></span></span><span style="display:flex;"><span><span style="color:#78787e"></span>        myValue.x <span style="color:#ff6ac1">=</span> c.x <span style="color:#ff6ac1">+</span> <span style="color:#ff9f43">1</span>;
</span></span><span style="display:flex;"><span>        myValue.y <span style="color:#ff6ac1">=</span> c.y <span style="color:#ff6ac1">+</span> <span style="color:#ff9f43">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff5c57">function</span> <span style="color:#57c7ff">getStruct</span> () <span style="color:#ff6ac1">public</span> <span style="color:#ff6ac1">view</span> <span style="color:#ff6ac1">returns</span> (ComplexStruct <span style="color:#ff6ac1">memory</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">return</span> myValue;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>(The commented-out numbers after the function signatures are the gas units consumed for executing each function, according to Remix IDE.)</p>
<p>Though it&rsquo;s not explicitly stated in the code listing, <code>myValue</code> is allocated to the contract&rsquo;s storage.</p>
<p>The first two functions (<code>setStruct1</code>, <code>setStruct2</code>) take in a struct stored in <code>calldata</code>, and thus, the more efficient of the two (<code>setStruct2</code>), is actually the most efficient in the whole contract.</p>
<p><code>setStruct3</code> and <code>setStruct4</code> are identical to their N−2 analogues, with the exception that they use <code>memory</code> instead of <code>calldata</code>.</p>
<p>Note that we could not call <code>setStruct1</code> or <code>setStruct2</code> from another function within the contract, because we cannot convert from <code>memory</code> to <code>calldata</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span>setStruct1(ComplexStruct({ x<span style="color:#ff6ac1">:</span> <span style="color:#ff9f43">1</span>, y<span style="color:#ff6ac1">:</span> <span style="color:#ff9f43">2</span> }));
</span></span><span style="display:flex;"><span><span style="color:#78787e">// TypeError: Invalid type for argument in function call. Invalid implicit conversion from struct StorageTest.ComplexStruct memory to struct StorageTest.ComplexStruct calldata requested.
</span></span></span></code></pre></div><p>Remember: calldata is <em>immutable</em>!</p>
<h2 id="the-alternative">The Alternative</h2>
<p>This whole <code>memory</code>-<code>calldata</code> fiasco is pretty complicated. Unfortunately, there are many non-ideal design decisions still influencing the modern Solidity language. However, if you must deploy to an EVM-compatible chain, Solidity is still the language of choice. It has the best editor support, tooling, resources, and community of any other smart contract DSL.</p>
<p>That&rsquo;s a necessary qualifier—&ldquo;smart contract DSL&rdquo;—because, as it turns out, smart contracts can be written in general-purpose programming languages as well, even those with richer ecosystems than Solidity&rsquo;s.</p>
<p>Enter: <a href="https://near.org">NEAR</a>.</p>
<p>NEAR&rsquo;s virtual machine runs WebAssembly code, meaning one could conceivably write smart contracts for NEAR in any GPL with a WASM compile target. NEAR provides official SDKs for two of those languages: Rust and AssemblyScript.</p>
<p>Rust is a popular programming language developed by Mozilla. It&rsquo;s strongly typed, with a friendly compiler and an even friendlier community, and it&rsquo;s <a href="https://insights.stackoverflow.com/survey/2021#technology-most-loved-dreaded-and-wanted">the #1 most-loved programming language for six years running</a>.</p>
<p>AssemblyScript is a dialect of TypeScript, which is a strict superset of JavaScript. This means that traditional web2 developers can pick it up in no time!</p>
<p>Using a general-purpose programming language for smart contracts means that the programming paradigm is much more normalized: smart contracts merely run in the context of a regular WASM VM injected with the blockchain-specific environment globals.</p>
<p>Programmers don&rsquo;t have to specify a storage location for data anymore: variables are just normal variables, and there&rsquo;s an SDK for I/O to the key-value storage system.</p>
<p><a href="https://github.com/near-examples/counter/blob/master/assembly/main.ts">Check out this simple example contract</a>, written in AssemblyScript. Permanent, on-chain storage is invoked with a put/get API, making it much more obvious what exactly is happening to the data.</p>
<p>If you&rsquo;re familiar with Rust, you may find <a href="https://github.com/near-examples/NFT/blob/master/nft/src/lib.rs">this full NFT implementation</a> more interesting.</p>
<p>When I first encountered the NEAR ecosystem, I was stunned at how developer-friendly the contract programming interface was. In the time since then, it&rsquo;s only gotten better! (Not to mention the gas fees are minuscule compared to ETH: you&rsquo;re looking at fractions of a cent.) If you&rsquo;re interested in learning more about smart contract development on the NEAR ecosystem, head over to <a href="https://www.near.university/">NEAR University</a> and sign up for one of the free training bootcamps.</p>
<p>You can find a comprehensive suite of NEAR smart contracts on the <a href="https://github.com/Learn-NEAR">Learn NEAR GitHub organization</a>, as well as a bevy of tutorials and examples on the <a href="https://github.com/near-examples">NEAR Examples GitHub origanization</a>.</p>
<p>Good luck!</p>
<hr>
<p>I&rsquo;m a software engineer for <a href="https://near.org/">NEAR Protocol</a>, head of education at the <a
    href="https://www.blockchainacceleration.org/">Blockchain Acceleration Foundation</a>, and a graduate
  student at the <a href="https://www.titech.ac.jp/">Tokyo Institute of Technology</a>.</p>
<p>Connect with me <a href="https://twitter.com/sudo_build">on Twitter</a>.</p>
</div>
</article>
<footer class="py:24">
    <div class="f:fade-50 f:fade-60@dark f:14 mb:8">© Copyright 2022 Jacob Lindahl</div>
    <div class="f:fade-80 f:fade-40@dark f:12">Theme <a class="f:bold" href="https://github.com/serkodev/holy"
            _target="_blank">Holy</a></div>
</footer>
</div>
    </div>
</body>

</html>
